<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252"><script type="text/javascript" src="exploitation_files/jquery-1.js"></script>
 <script src="exploitation_files/bootstrap.html"></script>
 <link href="exploitation_files/bootstrap_002.html" rel="stylesheet" media="screen">
 <link href="exploitation_files/css.css" rel="stylesheet" type="text/css">
 <script src="exploitation_files/run_prettify.html"></script>



<style>
  body  {background:black;}
  pre   {color:white; }
  div   {color:white;}
  p     {color:white;}
  a:link {color:white;}      /* unvisited link */
  a:visited {color:white;}  /* visited link */
</style>
</head><body>

<div class="container">
  <br><br><br><br>
  <div id="words" style="font-size:500%; font-family: 'Gilda Display', serif;">EXPLOITATION</div>

  <div class="row-fluid">






<br><br><br><br><br>




<p>

Note: If you don't manage to get a particular exploit to 100%, describe 
what you would have done to get it there and you might get marks.

Question 1: Find and exploit the format string vulnerability, to get a 
shell.
Compile with "-m32 -z execstack -fno-stack-protector"

<br><br>
</p><pre class="prettyprint" style="background:white">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int
terminate(char *s)
{
 printf(s);
 printf("\n");
 exit(0);
}

int
main(int argc, char *argv[])
{
	int i;
	
	if (argc &lt; 2) terminate("Not enough arguments");

	//check for % signs
	for (i = 1; i &lt; argc; i++) {
		if (strchr((const char *)argv[i], '%') != NULL)
			terminate("Invalid character found");
	}

	i = 0;
 	//print out the arguments
 	printf("You called me with:\n");
	while (i &lt; argc) {
		printf(argv[i++]);
		printf(" ");
	}
	printf("\n");
}
 </pre>

<p></p>


<p>
<br><br><br><br>
Question 2: Exploit it.
Compile with "-m32 -z execstack -fno-stack-protector"
<br><br>
</p><pre class="prettyprint" style="background:white">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

void
vuln(char * s)
{

        char buf[256];
        strcpy(buf, s);
}

void
check(char *s)
{
        char random[8] = {0};
        unsigned int * ptr = (unsigned int *) s;
        FILE * f = fopen("/dev/urandom", "rb");

        fgets(random, 8, f);
        fclose(f);

        *ptr ^= 0xdeadbeef;
        ptr++;
        *ptr ^= 0xdeadbeef;

        if(strcmp(random, s) == 0)
                vuln(s+8);
        exit(-1);
}

int
main(int argc, char *argv[])
{
        if (argc != 2)
                exit(-4);

        check(argv[1]);

        return 0;
}


</pre>

<p></p>


<p>
	<br><br><br><br>
Question 3: Exploit it; you may disable ASLR with "ulimit -s unlimited" or otherwise.
Compile with "-m32 -z execstack -fno-stack-protector"
Extra BONUS mark if you can do it with full ASLR.
<br><br>
</p><pre class="prettyprint" style="background:white">#include &lt;stdio.h&gt;

void
call(int addr)
{
        int m = 0;
        void (*blah)(void *);

        blah = addr;
        blah(&amp;m);
}

int
main(int argc, char *argv[], char *envp[])
{
        int val, i;

        if (argc != 2 || strcmp(argv[0], "./level3") != 0 || strlen(argv[1]) &gt; 12)
        {
                printf("Wrong arguments\n");
                exit(-1);
        }

        if (envp[0] != NULL) {
                printf("Environment variables in use\n");
                exit(-2);
        }

        val = strtol(argv[1], NULL, 10);

        if (val != 0) {
                call(val);
        }
}
</pre>

<p></p>

</div>




</div></body></html>