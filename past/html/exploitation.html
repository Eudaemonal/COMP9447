<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252"><script type="text/javascript" src="exploitation_files/jquery-1.js"></script>
 <script src="exploitation_files/bootstrap.js"></script>
 <link href="exploitation_files/bootstrap.css" rel="stylesheet" media="screen">
 <link href="exploitation_files/css.css" rel="stylesheet" type="text/css">
 <link rel="stylesheet" type="text/css" href="exploitation_files/prettify.css">




<style>
  body  {background:black;}
  pre   {color:white; }
  div   {color:white;}
  p     {color:white;}
  a:link {color:white;}      /* unvisited link */
  a:visited {color:white;}  /* visited link */
</style>
</head><body>

<div class="container">
  <br><br><br><br>
  <div id="words" style="font-size:500%; font-family: 'Gilda Display', serif;">EXPLOITATION</div>

  <div class="row-fluid">






<br><br><br>


<h4>Write an exploit for the following programs.</h4>


<p>

Note: If you don't manage to get a particular exploit to 100%, describe 
what you would have done to get it there and you might get marks.
<br><br>

Question 1.
</p>
<pre class="prettyprint prettyprinted" style="background: white none repeat scroll 0% 0%;"><span class="com">#include</span><span class="pln"> </span><stdlib.h><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><string.h><span class="pln">

</span><span class="com">// 9447 2015s2</span><span class="pln">
</span><span class="com">// &gt; exploitation #1</span><span class="pln">
</span><span class="com">// compile: gcc q1.c -o q1 -m32 </span><span class="pln">

</span><span class="com">// goal: </span><span class="pln">
</span><span class="com">// exploit this program to obtain a shell</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> win</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    execv</span><span class="pun">(</span><span class="str">"/bin/sh"</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">char</span><span class="pln"> buf</span><span class="pun">[</span><span class="lit">256</span><span class="pun">];</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">argc </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">exit</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">

    strcpy</span><span class="pun">(</span><span class="pln">buf</span><span class="pun">,</span><span class="pln"> argv</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></string.h></stdlib.h></pre>


<br><br>

<p>
<br><br><br><br>
Question 2.
</p><pre class="prettyprint prettyprinted" style="background: white none repeat scroll 0% 0%;"><span class="com">#include</span><span class="pln"> </span><stdlib.h><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><string.h><span class="pln">
</span><span class="com">#include</span><span class="pln"> </span><stdio.h><span class="pln">

</span><span class="com">// 9447 2015s2</span><span class="pln">
</span><span class="com">// &gt; exploitation #2</span><span class="pln">
</span><span class="com">// compile: gcc q2.c -o q2 -m32</span><span class="pln">

</span><span class="com">// goal: </span><span class="pln">
</span><span class="com">// write a ROP exploit for this program</span><span class="pln">
</span><span class="com">// you may find the leaked address of the payload buffer useful</span><span class="pln">
</span><span class="com">// after setting up the stack, provide an address to jump to</span><span class="pln">

</span><span class="com">// warning: this has a non-executable stack! </span><span class="pln">
</span><span class="com">//          you DO NOT need shellcode.</span><span class="pln">

</span><span class="com">// note: you also don't need ROPGadget - objdump works fine here.</span><span class="pln">
</span><span class="com">//       e.g. % objdump -D q2 | grep </span><what_you_need><span class="pln">

</span><span class="kwd">void</span><span class="pln"> fail</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    system</span><span class="pun">(</span><span class="str">"/bin/echo 'wtf?...'"</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
    setbuf</span><span class="pun">(</span><span class="pln">stdout</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> rop </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">char</span><span class="pln"> buf</span><span class="pun">[</span><span class="lit">512</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">};</span><span class="pln">
    
    printf</span><span class="pun">(</span><span class="str">"leak: %p\n"</span><span class="pun">,</span><span class="pln"> buf</span><span class="pun">);</span><span class="pln">

    printf</span><span class="pun">(</span><span class="str">"enter buf data: "</span><span class="pun">);</span><span class="pln">
    fgets</span><span class="pun">(</span><span class="pln">buf</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">buf</span><span class="pun">),</span><span class="pln"> stdin</span><span class="pun">);</span><span class="pln">

    printf</span><span class="pun">(</span><span class="str">"enter jump addr (in hex): "</span><span class="pun">);</span><span class="pln">
    scanf</span><span class="pun">(</span><span class="str">"%x"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">rop</span><span class="pun">);</span><span class="pln">
    
    printf</span><span class="pun">(</span><span class="str">"good luck!\n"</span><span class="pun">,</span><span class="pln"> rop</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">(*(</span><span class="kwd">void</span><span class="pun">(*)())</span><span class="pln"> rop</span><span class="pun">)();</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></what_you_need></stdio.h></string.h></stdlib.h></pre>

<p></p>


</div>




</div></body></html>